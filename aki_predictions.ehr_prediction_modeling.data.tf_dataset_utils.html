
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils module &#8212; aki-predictions 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="aki_predictions.ehr_prediction_modeling.embeddings package" href="aki_predictions.ehr_prediction_modeling.embeddings.html" />
    <link rel="prev" title="aki_predictions.ehr_prediction_modeling.data.tf_dataset module" href="aki_predictions.ehr_prediction_modeling.data.tf_dataset.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils">
<span id="aki-predictions-ehr-prediction-modeling-data-tf-dataset-utils-module"></span><h1>aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils module<a class="headerlink" href="#module-aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils" title="Permalink to this heading">¶</a></h1>
<p>TensorFlow utility functions to extract Tensor and batch from tf protos.</p>
<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.add_beginning_of_sequence_mask_and_pad">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">add_beginning_of_sequence_mask_and_pad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">example</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_unroll</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DatasetV1</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.add_beginning_of_sequence_mask_and_pad" title="Permalink to this definition">¶</a></dt>
<dd><p>Pad sequence to be divisible by num_unroll and set end of sequence mask.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.append_nested_dict_of_lists">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">append_nested_dict_of_lists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nested_dict_of_lists</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nested_dict_new_items</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.append_nested_dict_of_lists" title="Permalink to this definition">¶</a></dt>
<dd><p>Appends items in a nested dictionary of items to a nested dict of the same structure of lists</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nested_dict_of_lists</strong> (<em>dict</em>) – nested dict of lists</p></li>
<li><p><strong>(</strong><strong>dict</strong> (<em>nested_dict_new_items</em>) – nested dict of items</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>nested dict of lists</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_required_tensors_to_sparse">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">convert_required_tensors_to_sparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">examples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tensor_to_sparse_keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_required_tensors_to_sparse" title="Permalink to this definition">¶</a></dt>
<dd><p>In a dictionary ‘examples’ with keys ‘context’ and ‘sequences’, within ‘sequences’ convert any items
that are tf.Tensor objects and whose key appears in tensor_to_sparse_keys into SparseTensor objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>examples</strong> (<em>dict</em>) – Dictionary with ‘context’ and ‘sequences’ keys, with tf.Tensor objects in ‘sequences’</p></li>
<li><p><strong>tensor_to_sparse_keys</strong> (<em>list of str</em>) – the keys which correspond to items in examples[‘sequences’]</p></li>
<li><p><strong>SparseTensors</strong> (<em>that contain tf.Tensors and are desired to be turned into</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary with ‘context’ and ‘sequences’ keys, with some keys now corresponding to SparseTensors</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_sparse_context_to_segments">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">convert_sparse_context_to_segments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">examples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_sparse_context_to_segments" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the serialized example into time-major sequence and context.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_to_segments">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">convert_to_segments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">examples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_to_segments" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the serialized example into time-major sequence and context.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_to_time_major">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">convert_to_time_major</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">examples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.convert_to_time_major" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the serialized example into time-major sequence and context.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.extract_ndarray_at_idx_from_nested_dict_of_lists_of_ndarrays">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">extract_ndarray_at_idx_from_nested_dict_of_lists_of_ndarrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.extract_ndarray_at_idx_from_nested_dict_of_lists_of_ndarrays" title="Permalink to this definition">¶</a></dt>
<dd><p>From a nested dictionary of lists of ndarrays, extract the idx element from each list and return in the same
nested dictionary structure.
:param input_dict: a nested dictionary of lists of ndarrays
:type input_dict: dict
:param idx: index of ndarray in each list to extract
:type idx: int</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Nested dictionary of ndarrays</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.get_label_dicts">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">get_label_dicts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_coordinator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="aki_predictions.ehr_prediction_modeling.tasks.coordinator.html#aki_predictions.ehr_prediction_modeling.tasks.coordinator.Coordinator" title="aki_predictions.ehr_prediction_modeling.tasks.coordinator.Coordinator"><span class="pre">Coordinator</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sequential_features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_len_metadata</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">FixedLenSequenceFeature</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">FixedLenFeature</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">FixedLenSequenceFeature</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">FixedLenFeature</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.get_label_dicts" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the feature dictionaries to parse a tf.SequenceExample.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fixed_len_metadata</strong> – list of context data expected to have fixed length from the batch generator</p></li>
<li><p><strong>task_coordinator</strong> – tasks.Coordinator instance with the info about tasks.</p></li>
<li><p><strong>context_features</strong> – list of features to extract from the context.</p></li>
<li><p><strong>sequential_features</strong> – list of features to extract from the sequence.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionaries of TF features to read in context.
sequence_d: Dictionaries of TF features to read in sequence.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>context_d</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.ndarray_from_sparse_definition">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">ndarray_from_sparse_definition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dense_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected_shape_1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.ndarray_from_sparse_definition" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses the indices, values and dense_shape definitions as used when defining a tf.sparse.SparseTensor to
create a dense ndarray. ndarrays can be necessary to create a data generator suitable for tf 1.15</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>expected_dims</strong> (<em>int</em>) – if dense_shape is None, provide an expected dimensionality of</p></li>
<li><p><strong>dimensionality</strong> (<em>the tensor to generate an empty array of that</em>) – </p></li>
<li><p><strong>expected_dims=2</strong> (<em>e.g.</em>) – </p></li>
<li><p><strong>[</strong><strong>[</strong><strong>]</strong><strong>]</strong> (<em>would lead to</em>) – </p></li>
<li><p><strong>[</strong><strong>[</strong><strong>[</strong><strong>]</strong><strong>]</strong><strong>]</strong> (<em>3 to</em>) – </p></li>
<li><p><strong>indices</strong> (<em>ndarray</em><em>, </em><em>int64</em>) – A 2D int64 of shape [N, ndims], which specifies the indices of the elements in the</p></li>
<li><p><strong>values</strong> (<em>ndarray</em>) – </p></li>
<li><p><strong>values</strong> – A 1D array of any type and shape [N], which supplies the values for each element in indices</p></li>
<li><p><strong>dense_shape</strong> (<em>ndarray</em>) – A 1D int64 ndarray of shape [ndims], which specifies the dense_shape of the sparse array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A zeros ndarray where sparse indices have been filled with values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(ndarray)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.pad_nested_dict_of_lists_of_ndarray">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">pad_nested_dict_of_lists_of_ndarray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_sequence_lengths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_zeroth_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.pad_nested_dict_of_lists_of_ndarray" title="Permalink to this definition">¶</a></dt>
<dd><p>Pads ndarrays in a nested dictionary of lists of ndarrays such that all ndarrays in a single list
become the same shape</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_zeroth_shape</strong> (<em>int</em>) – Instead of seeking the suitable padding dimension in the zeroth dimension,</p></li>
<li><p><strong>nested</strong> (<em>provide it here. Useful for when padding must be applied the same way across different branches of a</em>) – </p></li>
<li><p><strong>dictionary</strong> – </p></li>
<li><p><strong>input_dict</strong> (<em>dict</em>) – Nested dictionary of lists of ndarrays</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Nested dictionary of lists of padded ndarrays</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.prepend_batch_size_to_nested_dict_of_output_shapes">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">prepend_batch_size_to_nested_dict_of_output_shapes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.prepend_batch_size_to_nested_dict_of_output_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepend a batch_size to a nested dictionary of tf.TensorShape objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dict</strong> (<em>dict</em>) – nested dict of TensorShape objects</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – batch size</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.read_seqex_dataset">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">read_seqex_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tfrecords_filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">TFRecordDatasetV1</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.read_seqex_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return read sequential dataset.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.sample_segments">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">sample_segments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq_lens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_offset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.sample_segments" title="Permalink to this definition">¶</a></dt>
<dd><p>Sample fixed length segments from a list of sequence lengths.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seq_lens</strong> – A 1D tensor of sequence lengths.</p></li>
<li><p><strong>segment_length</strong> – Length of sampled segments.</p></li>
<li><p><strong>random_offset</strong> – Whether to apply a per-sequence random offset to the start of
each segments.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the sequence index and the
starting time/index of a segment.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A 2D tensor where each row contains two elements</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.seqex_to_dict">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">seqex_to_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">serialized_examples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_d</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sequence_d</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseTensor</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.seqex_to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the serialized example into time-major sequence and context.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.slice_sparse_tensor_context">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">slice_sparse_tensor_context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SparseTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_starts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SparseTensor</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.slice_sparse_tensor_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Slice segments from a sparse tensor [batch x feats].</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.slice_sparse_tensor_sequences">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">slice_sparse_tensor_sequences</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SparseTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_starts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SparseTensor</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.slice_sparse_tensor_sequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Slice segments from a sparse tensor [batch x num_unrol x feats].</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.slice_tensor">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">slice_tensor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_starts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.slice_tensor" title="Permalink to this definition">¶</a></dt>
<dd><p>Slice segments from a tensor [batch x num_unrol x feats].</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.sparse_tensor_to_time_major">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">sparse_tensor_to_time_major</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sparse_tensor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SparseTensor</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SparseTensor</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.sparse_tensor_to_time_major" title="Permalink to this definition">¶</a></dt>
<dd><p>Transposes batch major sparse tensors to time major.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.stack_nested_dict_of_lists_of_ndarrays">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">stack_nested_dict_of_lists_of_ndarrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.stack_nested_dict_of_lists_of_ndarrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Within a nested dictionary structure of lists of ndarrays, stack the lists into higher dimensional arrays</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dict</strong> (<em>dict</em>) – A nested dictionary where final items are lists of ndarrays, inside each list the dimensions</p></li>
<li><p><strong>lists</strong> (<em>of each ndarray is the same but dimensions can differ between</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Nested dictionary of ndarrays</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.tile_context">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">tile_context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_padding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.tile_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Tiles the context along the time dimension seq_len times and pads batch.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.to_time_major">
<span class="sig-prename descclassname"><span class="pre">aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.</span></span><span class="sig-name descname"><span class="pre">to_time_major</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="headerlink" href="#aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.to_time_major" title="Permalink to this definition">¶</a></dt>
<dd><p>Transposes batch majored tensors to time major.</p>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">aki-predictions</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">NHS AI Lab Skunkworks project: Predictive Renal Health</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="aki_predictions.html">aki_predictions package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="aki_predictions.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="aki_predictions.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">aki_predictions</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="aki_predictions.html">aki_predictions package</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="aki_predictions.html">aki_predictions package</a><ul>
  <li><a href="aki_predictions.ehr_prediction_modeling.html">aki_predictions.ehr_prediction_modeling package</a><ul>
  <li><a href="aki_predictions.ehr_prediction_modeling.data.html">aki_predictions.ehr_prediction_modeling.data package</a><ul>
      <li>Previous: <a href="aki_predictions.ehr_prediction_modeling.data.tf_dataset.html" title="previous chapter">aki_predictions.ehr_prediction_modeling.data.tf_dataset module</a></li>
      <li>Next: <a href="aki_predictions.ehr_prediction_modeling.embeddings.html" title="next chapter">aki_predictions.ehr_prediction_modeling.embeddings package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Crown copyright.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/aki_predictions.ehr_prediction_modeling.data.tf_dataset_utils.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>